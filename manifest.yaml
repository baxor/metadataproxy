name: metadataproxy
description: Intercepts calls to EC2 Metadata Service from containers.
repository: git@github.com:lyft/metadataproxy.git
pagerduty_escalation_policy: DevX
team_email: devnull@lyft.com
containers:
  - name: server
    command: /code/metadataproxy/entrypoint.sh
    provision: /code/metadataproxy/provision.sh
    network: host
    mounts:
      - /var/run/docker_sockets
    start_phase: sequential_init
    privileged: true

groups:
  - name: dev
    members:
      - metadataproxy.server

tests:
  - name: startup
    type: startup
    group: metadataproxy.dev
deploy:
  - name: development
    legacy: false
  - name: staging-orca
    legacy: false
    kubernetes:
      enabled: true
    targets:
      - facet: orca
    automatic: false
    orca: []
  - name: staging
    legacy: false
    orca: []
  - name: production-orca
    legacy: false
    kubernetes:
      enabled: true
    targets:
      - facet: orca
    automatic: false
    orca: []
  - name: canary
    legacy: false
    orca: []
  - name: production
    legacy: false
builder:
  name: docker_build
  params:
    dockerfile: Dockerfile.private
facets:
  - name: orca
    type: legacyorca
    member: metadataproxy.server
